<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <button class="btn btn-success" (click)="openForm()">
              <i class="fa fa-plus"></i> Registrar
            </button>
            <div
              class="card-tools"
              style="display: flex; gap: 16px; align-items: center"
            >
              <div class="input-group" style="width: 250px">
                <select
                  (change)="onAreaChange()"
                  class="form-control"
                  id="area"
                  [(ngModel)]="areaId"
                  name="area"
                  required
                >
                  <option value="" selected>Seleccionar</option>
                  <option *ngFor="let area of dataAreaAll" [value]="area?.Id">
                    {{ area?.Name }}
                  </option>
                </select>
              </div>
              <div *ngIf="isAdmin">
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="activeCheckbox"
                    [(ngModel)]="filterActive"
                    (change)="onFilterActiveChange()"
                  />
                  <label class="form-check-label" for="activeCheckbox"
                    >Activo</label
                  >
                </div>
                <div class="form-check form-check-inline">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="inactiveCheckbox"
                    [(ngModel)]="filterInactive"
                    (change)="onFilterInactiveChange()"
                  />
                  <label class="form-check-label" for="inactiveCheckbox"
                    >Inactivo</label
                  >
                </div>
              </div>
              <div class="input-group" style="width: 250px">
                <input
                  type="text"
                  name="table_search"
                  class="form-control float-right"
                  placeholder="Buscar"
                  (keyup)="onSearch($event)"
                />
                <div class="input-group-append">
                  <button type="submit" class="btn btn-default">
                    <i class="fas fa-search"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body table-responsive p-0">
            <table class="table table-hover text-nowrap">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>N° de verificación</th>
                  <th>Area</th>
                  <th>Tipo de documento</th>
                  <th>Año</th>
                  <th>Estado</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let data of getPaginatedAreas()">
                  <td>{{ data.Name }}</td>
                  <td>{{ data.VerificationCode }}</td>
                  <td>{{ data.Area ? data.Area.Name : "" }}</td>
                  <td>{{ data.Type ? data.Type.Name : "" }}</td>
                  <td>{{ data.YearPublication }}</td>
                  <td>
                    <span
                      class="badge bg-{{
                        data.IsActive ? 'success' : 'danger'
                      }}"
                      >{{ data.IsActive ? "Activo" : "Inactivo" }}</span
                    >
                  </td>
                  <td style="display: flex; gap: 8px">
                    <button
                      [disabled]="!data.FilePath"
                      tooltip="Descargar documento"
                      class="btn btn-xs btn-danger"
                      title="Ver detalle"
                      (click)="openPdf(data.FilePath)"
                    >
                      <i class="fa fa-file-pdf"></i>
                    </button>
                    <button
                      *ngIf="
                        this.isEvaluateShowOpenFormFile(data.FilePath || '')
                      "
                      class="btn btn-xs btn-success"
                      title="Ver detalle"
                      (click)="openFormFile(data)"
                    >
                      <i class="fa fa-file-upload"></i>
                    </button>
                    <button
                      class="btn btn-xs btn-info"
                      (click)="openForm(data, true)"
                      title="Ver detalle"
                    >
                      <i class="fa fa-eye"></i>
                    </button>
                    <button
                      *ngIf="data.IsActive && isAdmin"
                      class="btn btn-xs btn-warning"
                      (click)="openForm(data)"
                      title="Editar"
                    >
                      <i class="fa fa-edit"></i>
                    </button>
                    <button
                      *ngIf="data.IsActive && isAdmin"
                      class="btn btn-xs btn-danger"
                      (click)="openConfirmModal('inactivate', data)"
                      title="Eliminar"
                    >
                      <i class="fa fa-trash"></i>
                    </button>
                    <button
                      *ngIf="!data.IsActive && isAdmin"
                      class="btn btn-xs btn-success"
                      (click)="openConfirmModal('activate', data)"
                      title="Activar"
                    >
                      <i class="fa fa-undo"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
              <tfoot></tfoot>
            </table>
            <div
              class="box-footer clearfix"
              style="margin: 16px 60px"
              *ngIf="filteredData.length > 0"
            >
              <ul class="pagination pagination-sm no-margin float-right">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a
                    class="page-link"
                    href="javascript:void(0)"
                    (click)="currentPage = 1"
                    >&laquo;</a
                  >
                </li>
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a
                    class="page-link"
                    href="javascript:void(0)"
                    (click)="currentPage = currentPage - 1"
                    >&lsaquo;</a
                  >
                </li>
                <li
                  class="page-item"
                  *ngFor="
                    let page of [].constructor(getTotalPages());
                    let i = index
                  "
                  [class.active]="currentPage === i + 1"
                >
                  <a
                    class="page-link"
                    href="javascript:void(0)"
                    (click)="currentPage = i + 1"
                    >{{ i + 1 }}</a
                  >
                </li>
                <li
                  class="page-item"
                  [class.disabled]="currentPage === getTotalPages()"
                >
                  <a
                    class="page-link"
                    href="javascript:void(0)"
                    (click)="currentPage = currentPage + 1"
                    >&rsaquo;</a
                  >
                </li>
                <li
                  class="page-item"
                  [class.disabled]="currentPage === getTotalPages()"
                >
                  <a
                    class="page-link"
                    href="javascript:void(0)"
                    (click)="currentPage = getTotalPages()"
                    >&raquo;</a
                  >
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div #formModal class="modal modal-backdrop fade" role="dialog">
  <div class="modal-dialog content-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">
          {{ id ? "Editar un registro" : "Registrar un nuevo registro" }}
        </h4>
        <button type="button" class="close" (click)="closeModal()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form #dataForm="ngForm">
          <div class="form-group">
            <label for="name">Nombre del documento</label>
            <input
              type="text"
              class="form-control"
              id="name"
              [(ngModel)]="selectedData.Name"
              name="name"
              placeholder="Nombre del tipo de documento"
              [readonly]="viewOnly"
              required
              title="Solo letras y acentos"
              pattern="^[a-zA-Z\sáéíóúÁÉÍÓÚñÑ]+$"
              oninput="this.value = this.value.replace(/[^a-zA-Z\sáéíóúÁÉÍÓÚñÑ]/g, '').toUpperCase()"
            />
          </div>
          <div class="form-group" *ngIf="viewOnly">
            <label for="verificationCode">Código de verificación</label>
            <input
              type="text"
              class="form-control"
              id="verificationCode"
              [(ngModel)]="selectedData.VerificationCode"
              name="verificationCode"
              placeholder="Código de verificación"
              [readonly]="viewOnly"
              pattern="^[a-zA-Z\sáéíóúÁÉÍÓÚñÑ]+$"
              oninput="this.value = this.value.replace(/[^a-zA-Z\sáéíóúÁÉÍÓÚñÑ]/g, '').toUpperCase()"
            />
          </div>
          <div class="form-group">
            <label for="yearPublication">Año de publicación</label>
            <input
              type="number"
              class="form-control"
              id="yearPublication"
              [(ngModel)]="selectedData.YearPublication"
              name="yearPublication"
              placeholder="Año de publicación"
              [readonly]="viewOnly"
              required
              min="1000"
              max="9999"
            />
          </div>
          <div class="form-group">
            <label for="description">Descripción</label>
            <textarea
              class="form-control"
              id="description"
              [(ngModel)]="selectedData.Description"
              name="description"
              placeholder="Descripción"
              [readonly]="viewOnly"
              required
              pattern="^[a-zA-Z\sáéíóúÁÉÍÓÚñÑ]+$"
              oninput="this.value = this.value.replace(/[^a-zA-Z\sáéíóúÁÉÍÓÚñÑ]/g, '').toUpperCase()"
            ></textarea>
          </div>
          <!-- <div class="form-group" style="display: flex; flex-direction: column">
            <label for="filePath">Ruta del archivo</label>
            <input
              (change)="onFileSelected($event)"
              type="file"
              class="form-control"
              id="filePath"
              [(ngModel)]="selectedData.FilePath"
              name="filePath"
              placeholder="Ruta del archivo"
              *ngIf="!viewOnly"
              [required]="!id"
            />
            <label *ngIf="!viewOnly" style="margin-bottom: 8px">{{
              selectedData.FilePath
            }}</label>
            <a
              style="color: cornflowerblue"
              *ngIf="viewOnly"
              (click)="openPdf(selectedData.FilePath || '')"
              >Descargar documento</a
            >
          </div> -->
          <div class="form-group">
            <label for="area">Área</label>
            <select
              class="form-control"
              id="area"
              [(ngModel)]="selectedData.AreaId"
              name="area"
              disabled
              required
            >
              <option value="0" selected>Seleccionar</option>
              <option *ngFor="let area of dataAreaAll" [value]="area?.Id">
                {{ area?.Name }}
              </option>
            </select>
          </div>
          <div class="form-group">
            <label for="type">Tipo de documento</label>
            <select
              class="form-control"
              id="type"
              [(ngModel)]="selectedData.TypeId"
              name="type"
              [disabled]="viewOnly"
              required
            >
              <option value="0" selected>Seleccionar</option>
              <option
                *ngFor="let type of dataDocumentTypeAll"
                [value]="type?.Id"
              >
                {{ type?.Name }}
              </option>
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" (click)="closeModal()">
          Cerrar
        </button>
        <button
          [hidden]="viewOnly"
          type="button"
          class="btn btn-primary"
          (click)="saveData()"
          [disabled]="!dataForm.valid || selectedData.TypeId === 0 || isSaving"
        >
          {{ id ? "Editar" : "Guardar" }}
        </button>
      </div>
    </div>
  </div>
</div>
<div #formFileModal class="modal modal-backdrop fade" role="dialog">
  <div class="modal-dialog content-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">Subir archivo</h4>
        <button type="button" class="close" (click)="closeModalFile()">
          &times;
        </button>
      </div>
      <div class="modal-body">
        <form #dataFormFile="ngForm">
          <div class="form-group" style="display: flex; flex-direction: column">
            <label for="filePath">Ruta del archivo</label>
            <input
              (change)="onFileSelected($event)"
              type="file"
              class="form-control"
              id="filePath"
              [(ngModel)]="selectedData.FilePath"
              name="filePath"
              placeholder="Ruta del archivo"
            />
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button
          type="button"
          class="btn btn-success"
          (click)="closeModalFile()"
        >
          Cerrar
        </button>
        <button
          [hidden]="viewOnly"
          type="button"
          class="btn btn-primary"
          (click)="saveDataFile()"
          [disabled]="!dataFormFile.valid"
        >
          Subir archivo
        </button>
      </div>
    </div>
  </div>
</div>

<div #confirmModal class="modal modal-backdrop fade" role="dialog">
  <div class="modal-dialog content-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">
          {{
            confirmAction === "activate"
              ? "Activar registro"
              : "Inactivar registro"
          }}
        </h5>
        <button type="button" class="close" (click)="closeConfirmModal()">
          &times;
        </button>
      </div>
      <div class="modal-body" style="text-align: center">
        <i
          class="fa"
          [ngClass]="{
            'fa-check-circle text-success': confirmAction === 'activate',
            'fa-times-circle text-danger': confirmAction === 'inactivate'
          }"
          style="font-size: 48px; margin-bottom: 16px"
        ></i>
        <p>
          ¿Está seguro que desea
          {{ confirmAction === "activate" ? "activar" : "inactivar" }} este
          registro?
        </p>
      </div>
      <div class="modal-footer" style="justify-content: center; gap: 16px">
        <button
          type="button"
          class="btn btn-default"
          (click)="closeConfirmModal()"
        >
          Cancelar
        </button>
        <button
          type="button"
          [disabled]="isSaving"
          class="btn btn-primary"
          (click)="
            confirmAction === 'activate'
              ? confirmActivateData()
              : confirmInactivateData()
          "
        >
          Confirmar
        </button>
      </div>
    </div>
  </div>
</div>
